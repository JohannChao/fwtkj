### CIDR（无类型域间路由，Classless Inter-Domain Routing）
　　实例：某企业需要1000个IP地址，按上面学的知识，有两种分配方案，一是分配给该校1个B类地址，地这样会造成216-2-1000=64534个地址浪费。二是分配4个C类地址，这样会造成每个路由器的路由表增加4个相应的项。

　　另外，上面说的子网划分的解决方案存在一个问题就是浪费地址，过多的子网会导致主机地址减少。在每个子网内，总是有两个地址用于网络地址和广播地址。如果子网过多，地址数量最多有可能会减少一半。
举例说，一个C类网络通常支持254个主机。然而，把C类网络分成64个子网，这样每个子网分给主机的地址只有2个，主机地址就会从254个减少到128个。在IPv4中这样的做法是非常不可取的。

　　如何解决呢？方法就是丢弃分类地址概念，采用CIDR（无类型域间路由，Classless Inter-Domain Routing）

　　CIDR采用13～27位可变网络ID，而不是A-B-C类网络所用的固定的1字节、2字节和3字节。

　　CIDR消除了子网的概念，IP地址=网络前缀+主机号。使用[斜线记法]()，在IP地址后加上一个斜线“/”，然后写上网络前缀所占的位数。
如：20.1.1.1  255.192.0.0 按CIDR记为20.1.1.1/10，10表示连续10个1，也就是网络前缀占10位。再例如，CIDR地址200.1.1.2/24表示前24位用作网络前缀。

　　CIDR最大的好处就是大大缩减了路由器的路由表大小，而且减少了地址浪费。CIDR（Classless Inter-Domain Routing，无类型域间路由）的基本思想是取消IP地址的分类结构，
将多个地址块聚合在一起生成一个更大的网络，以包含更多的主机。CIDR支持路由聚合，能够将路由表中的许多路由条目合并为成更少的数目，因此可以限制路由器中路由表的增大，减少路由表项。
```text
CIDR最主要的特点有两个：

　　1）CIDR消除了传统的A类、B类和C类地址以及划分子网的概念，因而可以更加有效地分配IPv4的地址空间，并且可以在新的IPv6使用之前容许因特网的规模继续增长。

　　2）CIDR将网络前缀都相同的连续的IP地址组成“CIDR地址块”，地址是连续的。不然，就不可能设计出“包含所需地址、但排除不需要地址”的前缀。
    为了达到这个目的，超网块（supernet block）即大块的连续地址就分配给ISP(Internet Service Provider，互联网服务提供商)，然后ISP负责在用户当中划分这些地址，从而减轻了ISP自有路由器的负担。
```

### CIDR 应用示例
　　ISP拥有地址块200.0.64.0/18，某企业需要大约1000个IP地址， 2^10  = 1024，所占的主机地址位是10位，ISP分给该企业的IP地址块可以是：200.0.64.0/22（网络位22位，主机位10位）。

　　假如该企业下分四个子公司，个子公司需要的IP地址是：A公司500个、B公司250个、C公司120个、D公司120个。问如何用CIDR分配这些地址。

> 注意：示例分析中，"--"用于分割网络号和主机号

##### 1）ISP CIDR地址块分析（200.0.64.0/18）
　　这个地址的网络位是 18 位，剩余的主机位 14 位
```text
第一个地址为: 200.0.64.0    : 11001000.00000000.01--000000.00000011
最后一个地址: 200.0.127.255 : 11001000.00000000.01--111111.11111111

该ISP共有 2^14 = 16384个地址，共有 2^6 = 64个C类网（C类地址的网络标识由前3组8位二进制数表示）
C类网列表：200.0.64.0/24、200.0.65.0/24、... 200.0.127.0/24
```

##### 2）企业需要1000个IP地址分析步骤
　　企业需要1000个IP地址，2^10 = 1024 ，此时主机位最少是 10 位（多了浪费），网络位是 22位，此时将 200.0.64.0/22 “CIDR地址块”分配给企业可满足需求。
```text
200.0.64.0/22 IP地址块

第一个地址为: 200.0.64.0    : 11001000.00000000.010000--00.00000011
最后一个地址: 200.0.67.255  : 11001000.00000000.010000--11.11111111
```

##### 3）计算各个分公司需要的IP地址的网络位和主机位
　　A公司需要500个地址，2^9 = 512，此时可知 A 公司的IP 主机位是 9位，网络位是 23位

　　B公司需要250个地址，2^8 = 256，此时可知 B 公司的IP 主机位是 8位，网络位是 24位

　　C公司需要120个地址，2^7 = 128，此时可知 C 公司的IP 主机位是 7位，网络位是 25位

　　D公司需要120个地址，2^7 = 128，此时可知 D 公司的IP 主机位是 7位，网络位是 25位

##### 4）分析各个分公司需要的IP地址块
　　根据上表，将200.0.64.0/22再划分
```text
A公司：200.0.64.0/23
第一个地址为: 200.0.64.0    : 11001000.00000000.0100000--0.00000000
最后一个地址: 200.0.65.255  : 11001000.00000000.0100000--1.11111111

B公司：200.0.66.0/24
第一个地址为: 200.0.66.0    : 11001000.00000000.01000010.--00000000
最后一个地址: 200.0.66.255  : 11001000.00000000.01000010.--11111111

C公司：200.0.67.0/25
第一个地址为: 200.0.67.0    : 11001000.00000000.01000011.0--0000000
最后一个地址: 200.0.67.127  : 11001000.00000000.01000011.0--1111111

D公司：200.0.67.128/25
第一个地址为: 200.0.67.128  : 11001000.00000000.01000011.1--0000000
最后一个地址: 200.0.67.255  : 11001000.00000000.01000011.1--1111111
```

##### 5）总结
　　CIDR的标记方法，如果没有“/”，也可以按照十进制来表示子网掩码。
如A公司的掩码为:255.255.254.0, B公司的掩码为:255.255.255.0,C和D公司的掩码为255.255.255.128

　　从上面可以清楚看出地址聚合的概念，此例ISP拥有64个C类网络，如果不用CIDR，那在与该ISP相连的每个路由器的路由表中都有64个路由项，
而采用CIDR后，只需用路由聚合后的一个项目200.0.64.0/18就能找到该ISP，200.0.64.0/22就能找到该企业。这样就大大减少了路由项。
关于路由的问题不是本文的重点，有不清楚的地方请参阅其它资料。另外，支持CIDR的协议可以用全0和全1的网络，这样大大节约了地址。