2，开发技术
该博客系统采用java语言，以maven构建整体项目，git管理项目版本，后台使用spring boot框架，前台使用freemarker模板引擎驱动，数据库使用的是mysql。

2.1 运行环境 
该项目采用IntelliJ IDEA作为集成开发环境。IntelliJ IDEA相较于其他开发环境，其在智能代码助手，代码自动提示，重构各类版本工具整合以及代码分析方面，拥有无可比拟的优势。
它所提倡的智能编码，有助于减少程序员的工作，更适合程序的快速开发。

2.2 Java语言
Java是由Sun Microsystems公司于1995年推出一门面向对象的程序语言。Java编程语言的风格与C++语言十分接近，它继承了C++面向对象技术的核心，但摒弃了C++容易引起错误的指针，多继承以及运载符重载等特性。
引用Sun公司对Java语言的解释是：“Java编程语言是个简单、面向对象、分布式、解释性、健壮、安全、与系统无关、可移植、高性能、多线程和动态的语言”。
虽然Java已推出近30年，但它仍是应用最广泛，最受欢迎的编程语言之一，尤其是在互联网和企业应用方面，Java拥有明显的优势和市场地位。
而现阶段，比较火热的大数据平台，诸如Hadoop，Spark，Flink等，它们都是基于Java或Scala（一种运行于JVM的编程语言）开发的。

2.3 开发框架
2.3.1，spring 
spring是一个开源容器框架，最早由Rod Johnson创建，并在《Expert One-on-One：J2EE Design and Development》这本著作中进行了介绍。
Spring是为了解决企业级应用开发的复杂性而创建的，使用Spring可以让POJO实现之前只有EJB才能完成的事情。
为了降低Java开发的复杂性，Spring采用了以下策略：基于POJO实现编程过程中最小侵入性；通过控制反转使得组件之间保持松散耦合；面向切面的声明式编程；通过切面和模板减少样板式代码。
以上策略的实现，全部依赖于Spring 的两个核心特性，即依赖注入（dependency injection）和面向切面编程（aspect-oriented programming）
2.3.1.1 依赖注入（DI）
    提到依赖注入，就不得不提起控制反转（IOC），其实它俩是同一个概念的不同角度的描述。控制反转（Inversion of Control），并不是一种技术，而是一种设计思想。
    在之前的开发过程中，我们会直接在某一个对象内部通过new的方式来创建一个新的对象，之后才能使用这个新对象中实现的属性方法。这种方式是程序主动获取依赖对象，此时对象之间会高度耦合。
    而“控制反转”则是，专门有一个容器用于创建这些对象并根据依赖关系注入合适的对象。此时，对象并没有主动获取依赖对象，而是将创建及注入组合对象的控制权交给了IOC容器，由容器选择合适的对象进行注入。
    依赖注入，我们只需要提供简单的配置，IOC容器在运行期会根据这些配置自动获取组件对象之间的依赖关系，将这些依赖对象动态得注入到组件中去。
2.3.1.2 面向切面编程（AOP）
    面向切面编程，是一种编程思想，是对面向对象编程（OOP）的一种补充，在面向对象编程中，我们将程序抽象成各种对象，而在面向切面编程中，我们将程序抽象成各个切面。
    跨越应用程序的多个点的功能被称为横切关注点，这些横切关注点在概念上与应用程序的业务逻辑是分开，诸如：日志，事务管理，缓存及安全等方面。
    在使用面向切面编程时，我们可以预先定义一个通用的功能组件，然后通过声明的方式确定这个功能以何种方式在何处使用，就像触发器一样。
    通过使用AOP，可以实现了关切点问题与业务逻辑对象的彼此分离，从而最大程度降低程序的耦合。

2.3.2，springboot
初期的spring通过注解加配置文件的形式为项目开发提供了灵活的扩展性，但是随着spring的发展，其项目越来越庞大，配置文件也越来越繁琐，过于复杂的xml文件为人所诟病。
为了简化Spring应用的初始搭建以及开发过程，Spring社区推出了全新的web框架Spring Boot。
Spring Boot基于Spring4.0设计，作为Spring框架的扩展，它不仅延续了spring框架的核心思想IOC和AOP，而且通过消除各类XML配置文件，进一步简化了应用的开发和部署。
此外，springboot还提供了大量的集成依赖包，并已根据使用习惯解决了版本冲突及不稳定等问题。这些改良之处，使开发者可以更加专注于应用的开发，为更快，更高效的开发生态系统铺平了道路。
相较于Spring，Spring Boot有以下优点：
①，尽可能自动配置spring应用；
②，提供了内嵌的Tomcat/Jetty等web容器；
③，可以创建独立运行的Jar和War；
④，提供的“Strater”poms简化了maven配置；
⑤，提供生产指标,健壮检查和外部化配置；
⑥，绝对没有代码生成和XML配置要求。

2.3.3，SpringMVC
虽然当前系统使用的是SpringBoot框架进行的快速开发，但是其底层还是使用的SpringMVC框架进行请求的转发处理，并最终经过视图解析器的解析，渲染到前端页面。
2.3.3.1 SpringMVC工作流程
SpringMVC框架的核心类是DispatcherServlet类。DispatcherServlet类继承自FrameworkServlet类，但最终可以追溯到Servlet接口，因此当用户在前端页面发起一个请求时，SpringMVC框架处理这个请求的起点就是DispatcherServlet类中的service()方法。
DispatcherServlet接收到请求后，首先会调用处理器映射器（HandlerMapping）找到对应的处理器（controller中的方法），并返回一个Handler执行链（HandlerExecutionChain）。
接下来，根据处理器找到对应的处理器适配器（HandlerAdapter），随后生成的处理器适配器对这个处理器进行操作，返回一个封装好的模型视图（ModelAndView），这个模型视图中含有模板路径。
最后，根据配置文件选择合适的视图解析器（ViewResolver）对这个视图模型进行解析，解析完成后返回一个视图（View），经过渲染最终响应到前端页面。

2.3.4，spring data jpa
JPA的全称是Java Persistence API， 即Java 持久化API，是SUN公司推出的一套基于ORM的规范，内部是由一系列的接口和抽象类构成。
jpa 就是定义了一系列标准，让实体类和数据库中的表建立一个对应的关系，当我们在使用 java 操作实体类的时候能达到操作数据库中表的效果(不用写sql ,就可以达到效果），
jpa 的实现思想即是 ORM （Object Relation Mapping），用于在关系型数据库和业务实体对象之间作一个映射。
spirng data jpa是spring提供的一套简化JPA开发的框架，按照约定好的方法命名规则写dao层接口，就可以在不写接口实现的情况下，实现对数据库的访问和操作。
同时提供了很多除了CRUD之外的功能，如分页、排序、复杂查询等等。
Spring Data JPA 可以理解为 JPA 规范的再次封装抽象，底层还是使用了 Hibernate 的 JPA 技术实现。

2.3.5，FreeMarker
FreeMarker是一个用Java语言编写的模板引擎，它基于模板来生成文本输出。
FreeMarker与Web容器无关，即在Web运行时，它并不知道Servlet或HTTP，故此FreeMarker不仅可以用作表现层的实现技术，而且还可以用于生成XML，JSP或Java等各种文本文件。
在Java Web领域，FreeMarker是应用广泛的模板引擎，主要用于MVC中的view层，生成html展示数据给客户端，可以完全替代JSP。
FreeMarker的诞生是为了取代JSP。虽然JSP功能强大，可以写Java代码实现复杂的逻辑处理，但是页面会有大量业务逻辑，不利于维护和阅读，更不利于前后台分工，
容易破坏MVC结构，所以舍弃JSP，选择使用FreeMarker是大势所趋。

2.4 maven
Maven 是 Apache 开源组织下的一个开源项目，其本质是一个项目管理和整合工具，将项目开发和管理过程抽象成一个项目对象模型（POM）。
Maven 为开发者提供了一套完整的构建生命周期框架。开发团队几乎不用花多少时间就能够自动完成工程的基础构建配置，因为 Maven 使用了一个标准的目录结构和一个默认的构建生命周期。
在有多个开发团队环境的情况下，Maven 能够在很短的时间内使得每项工作都按照标准进行。
因为大部分的工程配置操作都非常简单并且可复用，在创建报告、检查、构建和测试自动配置时，Maven 可以让开发者的工作变得更简单。
此外，Maven 是跨平台的，这意味着无论是在 Windows 上，还是在 Linux 或者 Mac 上，都可以使用同样的命令。

2.5 git
Git 是一个开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。它是 Linus Torvalds 为了帮助管理 Linux 内核开发而开发的一个开放源码的版本控制软件。
Git 与常用的版本控制工具 CVS, Subversion 等不同，它采用了分布式版本库的方式，不必服务器端软件支持。
另外，Git 不仅仅是个版本控制系统，它也是个内容管理系统(CMS)，工作管理系统等。
它与SVN存在以下区别：
①Git是分布式的，而SVN不是，这也是GIT与其他版本控制系统最大的区别。
②Git的存储方式是将内容以元数据的方式存储，而SVN则是以文件方式存储。
③Git的分支相较于SVN，更为灵活，这一点在SVN中则体现为只是版本库中的另一个目录。
④Git不存在全局版本号，而SVN则存在。
⑤Git在内容完整性上，是要优于SVN的，其使用SHA-1哈希算法来对内容进行存储。

2.6 mysql
MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，它是当前最流行的关系型数据库管理系统之一，访问以及管理MySQL数据库使用的SQL结构化查询语言是最常用标准化语言。
作为一种关系型数据库管理系统，它将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。
大体来说，MySQL 可以分为 Server 层和存储引擎层两部分。
Server 层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。
而存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。 现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始成为了默认存储引擎。


4，总体设计
经过对系统的需求分析，接下来就进入到了系统设计阶段。该博客系统主要分为前台用户模块和后台管理员模块。
前台用户系统是博客系统的最基本的主体功能，包括首页文章列表展示，用户注册、登录，文章分类，文章标签，文章搜索框，热门文章以及最下方的友链等。
后台管理员系统则包括管理员对用户权限的设置，对文章标签、分类设置，删除文章，热门文章设置，以及友链设置等功能。

4.1 功能设计
该博客系统基于B/S结构打造，采用Spring框架的MVC功能实现控制层、业务逻辑和视图层的分离。该设计模式，便于前期的开发，以及后期的维护工作，也是当前Web项目最主流的开发模式。

4.1.1 前台用户系统
该博客项目对用户的访问，不设置任何权限，即任何访问者都可以浏览页面内容。只不过一些其他诸如评论、发布文章等功能需要用户注册登录，并获取相应的权限才可使用。
前台系统功能详情介绍如下：
1）博客首页，用户进入到访问当前博客系统，默认进入博客首页。在博客首页，上方菜单栏有文章各种分类模块以及文章搜索框，最右侧提供用户注册、登录按钮。
侧边栏有热门文章模块，文章标签模块，主页面则是博客文章列表展示模块。
2）文章搜索框，用户可以根据自己的需要，自行搜索当前博客系统内所有的文章。
3）文章标签，用户可以根据自己的喜好，点击某个标签，此时文章列表会展示该标签下的所有文章。
4）热门文章，用户可以在“热门文章”模块，直接点击某个文章直接进行浏览。
5）文章分类，文章分类可以在一级分类的基础上选择二级分类，例如，一级分类“技术”下可以有二级分类“Spring”、“Mysql”、“算法”等。用户可以根据自己的喜好，选择某个分类，此时文章列表会展示该分类下的所有文章。
6）点赞、评论、收藏功能，用户可以对喜爱的文章进行点赞，此时无需登录。但是如果想要对文章进行评论、收藏，则需要先进行注册、登录。
7）用户注册、登录，用户点击右上方注册按钮，跳转到注册页面，可在此页面注册该博客系统内的用户账号。注册成功后，点击登录按钮，输入账号密码即可登录。
8）用户个人中心，用户登录成功后，页面右上方的“注册”、“登录”按钮替换为“个人中心”、“退出登录”按钮。点击“个人中心”按钮，跳转到个人详情页面，
    在此页面，可以看到其注册信息，账号状态以及收藏、发布的文章，也可对已发布的文章进行修改、删除。
9）发布文章功能，此功能仅对核心用户开放，如果用户确实有发布文章的需要，可以向管理员申请此权限。    

4.1.2 后台管理员系统
通过专用URL，进入到后台管理员系统，只有在登录管理员账号的情况下，才可使用此系统下的功能。管理员在此系统下可以总览整个系统信息，对用户账号进行编辑和删除，设置文章标签和分类，文章内容管理，以及设置友链。
后台系统功能详情如下：
1）基础数据，管理员进入到后台系统，直接进入到基础信息页面。在此页面，可以查看当前博客系统部署的服务器信息，文章总数，用户总数，分类总数以及标签总数。
2）用户管理，在这个页面下可以查看所有用户的基础信息并对其进行编辑，包括重置用户密码，开放用户发布文章权限，冻结用户账号，删除用户账号。
3）文章管理，可以在此页面删除不合适的文章，也可以将某篇好文直接设为热门文章，增加曝光度。
4）标签管理，在此页面编辑当前系统中的所有标签。
5）分类管理，对整个博客系统中的所有一级、二级分类，进行统一管理。
6）友链设置，根据实际需求，添加友人博客链接，也可以在此处添加广告链接。

4.2 数据库设计
前台用户系统和后台管理员系统，都是使用的Mysql数据库进行数据存储，数据库可视化管理工具采用的是开源的DBeaver社区版。
数据库建表遵循三大范式，即第一范式确保表中每列的原子性，第二范式确保表中其他列只能与主键相关，第三范式确保非主键列之间不存在依赖关系。
依据上述范式，考虑好表与表之间的对应关系（一对一，一对多，多对多），在Mysql中新建名为tutou的数据库，确定的表结构如下：



5，功能实现

5.1 数据库连接
在application.yml文件中，配置数据库连接属性，使用druid数据库连接池与mysql数据库实现数据交互。
spring:
  resources:
    static-locations: classpath:static/,file:static/
  thymeleaf:
    cache: false
  datasource:
    url: jdbc:mysql://localhost:3306/tutouke?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai&zeroDateTimeBehavior=CONVERT_TO_NULL
    username: root
    password: 123456
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    
5.2 前台用户系统实现

5.2.1 首页功能
用户无需登录，即可进入博客首页，即index.ftl页面，该页面下的文章分类模块，文章标签模块，热门文章模块以及文章列表皆需要进行数据填充。
功能实现的代码步骤为，通过拦截器拦截用户请求（HttpServletRequest），此时判断servlet上下文（ServletContext）中文章实体类数据传输对象（该实体类对象包含文章分类属性，文章标签属性，热门文章属性以及文章列表属性）是否为空，
如果为空（当用户首次访问时，这些属性肯定为空），则从数据库中获取数据添加到servlet上下文。最终响应到前端页面时，servlet上下文中的数据可以直接在页面展示。

5.2.2 注册功能
用户点击注册按钮，进入到注册账号界面，提交注册信息时，前端userRegister()函数会对账号的长度（不小于5位），密码的规则（不小于8位，且包含字母和数字）以及账号密码是否同名进行校验，校验失败不会提交请求。
前端校验通过后，请求抵达后台，此时会对账号名进行重名校验，如果不满足以上规则，则注册失败，返回注册失败提醒信息，停留在该界面。
如果满足以上规则，则注册成功，使用md5对密码加密后返回新的加密字符串，调用userDao.save(user)函数在数据库tutouke_user_info表内插入用户信息，随后跳转到登录界面。

5.2.3 登录功能
用户点击登录按钮，跳转到登录界面，用户输入账号密码后，还需要输入下方验证码，验证码允许刷新。全部输入完成后，前端userLogin()函数采用与注册相同的校验步骤，对登录账号信息进行校验。
校验通过后，请求传入后台，此时调用userDao.findByUserName("userName")函数，根据用户名查询数据库，查询是否有此账号，若没有则返回失败信息提醒“当前系统不存在该用户！”；
有此账号，继续校验当前账号的状态信息，若当前账号被冻结，返回失败信息“当前用户账号已被冻结，请联系管理员！”；
如果当前登录账号状态有效，则在继续比对密码是否一致，密码验证通过，跳转到首页界面；密码验证不通过，返回失败信息“当前用户密码错误！”。
出现以上三种登录失败情况的任意一种，将停留在当前登录页面，同时刷新验证码。

5.2.4 退出登录功能
用户登录以后，点击页面右上方的退出登录按钮，此时删除session中的user属性request.getSession().removeAttribute("user")，退出系统账号，并跳转到博客首页。
用户没有主动点击退出登录按钮，超过30分钟无操作，也会自动退出账号（session默认失效时间30分钟）。用户退出登录以后，可以继续浏览该博客前台系统。

5.2.5 用户浏览功能
用户在不登录的情况下，也可以进行此类操作。用户在首页界面，点击某个标签，此时调用articleTagRelDao.findByTagId(tagId)，根据标签名称查出当前标签下所有的文章Id，再根据文章Id查出所有符合条件的文章。
也可以点击某个二级分类，此时在首页会列出该分类下所有的文章。
用户点击热门文章模块或文章列表中的某篇文章，会直接跳转到文章的详情页面，该页面显示文章主体内容，点赞次数，浏览次数，收藏次数，以及下方的评论内容。
用户在文章详情页面，可以使用文章的点赞功能，但无法使用评论、收藏功能（除非此时是登录状态）。

5.2.6 用户发布文章功能
用户注册完账号，账号默认不开启“发布文章”功能，如果想要发布文章，此时需要管理员分配相应的权限。
具备发布文章权限的用户，登录以后，右上角会显示“发布文章”按钮，此按钮权限由前端ftl标签进行校验<#if (user.userPublishArticle)?? && (user.userPublishArticle)==1>。
用户点击“发布文章”按钮，此时跳转到发布文章页面，此页面支持富文本编辑，由HandyEditor组件提供支持。
在发布文章界面，支持图片上传，设置文章标题，一级、二级分类，文章标签，封面图片等功能。

5.2.7 用户个人中心
在用户登录成功以后，可以点击右上方的“个人中心”按钮进入到个人中心界面。在此页面，侧边栏提供“个人信息”、“收藏”、“我的文章”菜单。
点击个人信息菜单，会根据当前用户ID查询数据库中的user表，回显账户名称，账号状态，注册时间等信息。
点击收藏菜单，此时根据用户ID查询tutouke_user_article_collection_rel表中的所有收藏文章id，再根据收藏表中的article_id查询对应的文章进行展示。
点击我的文章，则会根据用户id查询tutou_article_info表中所有由本人发布的文章，文章作者可以根据需要，对之前的文章进行再次编辑，删除以及查看操作。


5.3 后台管理员系统实现
通过专用URL（localhost:8080/ttk/），可以进入博客的后台管理系统，后台管理系统必须使用管理员账号登录以后，才可进行后续操作。

5.3.1 登录功能
进入后台管理员系统，默认首页是后台管理系统的登录界面。该界面的设计模板与用户登录界面相似，唯一不同的地方是，不提供账号注册按钮。
在该博客系统的管理员系统中，管理员账号只能通过SQL在数据库添加，不支持注册功能。
在后台管理系统的登录界面，输入管理员账号和密码以及下方的四位验证码，点击登录，此时前端JS不做校验，请求直接传到后台。
根据管理员账号查询数据库tutouke_admin_info表，如果不存在输入的管理员账号，返回错误信息“管理员登陆失败！”，停留在该页面。
若存在该管理员账号，继续比对加密后的密码，若比对失败，返回错误信息“管理员登陆失败！”，停留在该页面。比对成功，跳转到管理员系统“基本信息”菜单页面。
后台管理员系统，登录失败，只返回错误信息，而不提示详细错误信息，这一点和用户账号登录失败提醒错误详情是不同。

5.3.2 基本信息
基本信息界面，当前只提供展示功能，而不提供编辑功能。在此页面，展示服务器版本，IP信息，以及当前博客系统中的文章总数，分类总数，文章标签总数，和用户总数。

5.3.3 用户管理
点击用户管理菜单，进入用户管理界面。在此界面，管理员可以查看系统中所有用户的详情信息，以及对它们进行编辑操作。
使用分页功能，根据用户注册时间由近及远排序，查询tutouke_admin_info表中前10条用户信息用于展示。用户列表上方有用户搜索框，可以根据用户名模糊查询所有满足条件的搜索条件的用户。
用户列表展示用户名，用户注册时间，账号状态，是否有发布文章权限等字段，最后一列为操作列。由于当前博客系统用户字段较少，列表可以将用户信息全部展示出来，因为没有做用户详情跳转页面。
操作列支持对单个用户进行修改、删除操作，暂不支持多个用户批量操作。点击修改按钮，弹出当前所在行用户的修改页面，在此页面可以修改用户的发布文章权限和账号冻结状态。
点击删除操作，弹出提示框“是否删除”，确定删除后，在数据库tutouke_admin_info表删除该用户账号。

5.3.4 博客内容管理
博客内容管理菜单下，有三个子菜单，分别是文章分类管理，文章标签管理以及文章管理。

5.3.4.1 文章分类管理
进入文章分类管理界面，查询数据库tutouke_article_type_info表，根据分类优先级进行排序，优先级数字越小越靠前。主界面左侧显示一级分类，右侧显示二级分类。
文章分类列表展示文章分类名称，分类创建时间，分类优先级字段，最右侧是操作列。操作列提供分类修改（支持分类名称，分类优先级修改）及删除功能。
在两侧分类列表的上方，各有一个添加按钮，用于支持一级分类、二级分类的添加功能。

5.3.4.2 文章标签管理
文章标签管理界面，展示数据库tutouke_tag_info表中的所有标签项目，标签采用input类型并列展示，input输入框只回显标签名称字段，可直接在输入框中键入标签名称对标签进行修改、删除操作。
标签列表上方，提供新标签添加功能。

5.3.4.3 文章管理
文章管理界面，使用分页功能，根据文章发布时间由近及远排序，查询tutouke_article_info表中前10条文章信息用于展示。文章列表上方有文章搜索框，可以根据文章名称模糊查询所有满足搜索条件的文章。
文章列表展示了文章标题，文章分类，文章发布者，文章发布时间，浏览次数，点赞次数，收藏次数等字段，最后一列为操作列。文章列表上方，提供支持文章标题模糊搜索的搜索框。
操作列，支持将文章设为热门，文章删除，以及文章查看功能，暂不支持批量操作。

5.3.5 友链功能
在友链界面，根据友链优先级高低，查询展示数据库tutouke_link_info表中所有友链及广告信息。友链广告列表，展示了友链标题字段，友链URL，友链logo，友链排序优先级字段，最后一列为操作列。
管理员既可以在此页面设置自己亲友的链接，也可以将其他友链替换为广告，提升广告产品曝光度。

5.3.6 修改密码
管理员点击右上方系统菜单下的修改密码按钮，在当前页面弹出密码修改框，输入新的管理员密码点击确定，此时调用adminDao.setAdminPassword()方法，修改数据库表中的管理员密码。

5.3.7 退出系统
点击页面右上方的退出登录按钮，此时删除session中的admin属性request.getSession().removeAttribute("admin")，退出系统账号，并跳转到后台管理员系统登录界面。
管理员没有主动点击退出登录按钮，超过30分钟无操作，也会自动退出账号（session默认失效时间30分钟）。管理员退出登录以后，需再次登录，才可以继续操作该后台系统。


